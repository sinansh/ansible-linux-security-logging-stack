#### Minimal rsyslog config to forward ONLY Sysmon and auditd logs to SIEM

#### JSON output template for SIEM ingestion
template(name="SiemJsonFmt" type="string"
         string='{"@timestamp":"%TIMESTAMP:::date-rfc3339%","host":"%HOSTNAME%","program":"%programname%","message":%msg:::json%}\n')

#### Forward auditd logs
if ($programname == "auditd") then {
    action(
        type="omfwd"
        target="{{ siem_host }}"
        port="{{ siem_port }}"
        protocol="{{ siem_protocol }}"
        template="SiemJsonFmt"
    )
    stop
}

#### Forward Sysmon for Linux logs
#### NOTE: program name may appear as:
#### - "sysmon"
#### - "sysmonforlinux"
#### You can check via: journalctl -u sysmon -o cat | head
if ($programname == "sysmon" or $programname == "sysmonforlinux") then {
    action(
        type="omfwd"
        target="{{ siem_host }}"
        port="{{ siem_port }}"
        protocol="{{ siem_protocol }}"
        template="SiemJsonFmt"
    )
    stop
}
